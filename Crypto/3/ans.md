:::info
説明間違ってたらPRとかで教えて！
:::
#1
$\varphi$(1234) + $\varphi$(5678) + $\varphi$(9973) =?

https://keisan.casio.jp/exec/user/1511790555
上記のサイトで入力したらOK

$\varphi$(1234) + $\varphi$(5678) + $\varphi$(9973) = 616 + 2656 + 9972 = 13244

#2
以下の数字が素数か判定しなさい．スタートを数字の1とし，素数なら* 100を，素数でないなら+100をし，合計を求めよ．
- 999681217
- 999681186
- 140628287
- 140168112

上からTrue, False, True, Falseなので
1* 100 + 100 * 100 + 100 = 10020

求め方は色々ある．
下記のコードで求める方法もあり，factorDBで素因数分解できるかどうかを確かめるでもOK
```python
import random

def Miller_Rabin(n):
    if n == 2:
        return True
    if n > 2 and n % 2 == 0:
        return False

    s, t = 0, n-1
    while t & 1 == 0:
        s, t = s+1, t >> 1
    a = random.randint(1, n-1)
    if pow(a, t, n) == 1:
        return True
    for i in range(0, s):
        if pow(a, pow(2, i) * t, n) == n-1:
            return True
    return False

print(Miller_Rabin(999681217))
print(Miller_Rabin(999681186))
print(Miller_Rabin(140628287))
print(Miller_Rabin(140168112))
```
#3
```
p:167184408235053121359323803074507623050450810619430410857965305737992871681794742949729198482548109664871050636044805958055320695403892429985148795231813177394187103246491158369096078504348732118968031286668059537680818047267619342337213500650755769032310203484711737360083095095650702302809407609531590417873,
q:160254537469539779094889861075241644056505850095744699544584537118599295255994102824550779378104334030309208250944522103342267225290220084069857150020206462752998986321065310461825231457364722856841233206563846035119830750241285902737058360498455001791978192914297277997305426125724263575268837908870843149941,
e:well-known number,
Encrypted message: 1366384401377734243138969966657820177821571781598783340344123898246903957042264439266274186906597686621733362885856692578973466380881067505464998724558746775678936427126031222580003904325989064250105735582208415116596581918562994080628298709316386223922547809805210587813529346745939196861118129320894796936940519191024809884050163812092625981130915462380244184453564484690415764794979805679624203861697089839338131433805907030619203832090778980881793256680309536455450772427996699850512772816037812543014485273298486074100050465146965721397192432755291156011287417988896997241244325415395272383095645581245390816281
```
eがわかりませんが，well-knownということでスライドで説明した65537だと予測できます．
後は，RSAを実装するだけです．
```python
from Crypto.Util.number import getPrime, bytes_to_long, long_to_bytes

def enc(m, n, e):
    return pow(m, e, n)

def dec(c, p, q, e):
    n = p * q
    phi = (p-1)*(q-1)
    d = pow(e, -1, phi)
    return pow(c, d, n)

p = getPrime(1024)
q = getPrime(1024)
n = p * q
e = 65537

m = b"CSL24{RSA_is_very_important}"
m_int = bytes_to_long(m)

c = enc(m_int, n, e)
print(f"Encrypted message: {c}")

decrypted_m_int = dec(c, p, q, e)
decrypted_m = long_to_bytes(decrypted_m_int)
print(f"Decrypted message: {decrypted_m.decode()}")
```
せっかくなので，生成したプログラムを載せておきます．
まず，鍵生成は
$p,q \in P$のとき，$n=pq, de\equiv1\mod n$となるdを求める必要がありました．このdが秘密鍵であり，復号化するときに使用します．
では，暗号化から見ていきましょう．
```python
def enc(m, n, e):
    return pow(m, e, n)
```
pow関数の引数は
```python=
pow(底, 指数, mod)
```
となります．そのため pow(m, e, n)は$m^e\mod n$と同じことをしています．
では，わかっている情報で復号化していきましょう．
```python=
def dec(c, p, q, e):
    n = p * q
    phi = (p-1)*(q-1)
    d = pow(e, -1, phi)
    return pow(c, d, n)
```
n, $\varphi(n)$,dを求め，復号化:$c^d\mod n$となります．
後は，long_to_bytes関数でmをもとに戻すと以下が出現します．
`CSL24{RSA_is_very_important}`
#4
```
n: 97139961312384239075080721131188244842051515305572003521287545456189235939577,
e: 65537,
Encrypted message: 50826727040874016806840751525243675163767614205602835883600078854382143980528
```
生成したプログラムを以下に提示します．
```
import gmpy2
from Crypto.Util.number import getPrime, bytes_to_long, long_to_bytes

def enc(m, n, e):
    return pow(m, e, n)

def dec(c, p, q, e):
    n = p * q
    phi = (p - 1) * (q - 1)
    d = int(gmpy2.invert(e, phi))
    return pow(c, d, n)

n = 97139961312384239075080721131188244842051515305572003521287545456189235939577
e = 65537
c = 50826727040874016806840751525243675163767614205602835883600078854382143980528

p = 299681192390656691733849646142066664329
q = 324144336644773773047359441106332937713

m = b"CSL24{use_factordb}"
m_int = bytes_to_long(m)

c = enc(m_int, n, e)
print(f"n: {n},\ne: {e},\nEncrypted message: {c}")

decrypted_m_int = dec(c, p, q, e)
decrypted_m = long_to_bytes(decrypted_m_int)
print(f"Decrypted message: {decrypted_m.decode()}")

```
今回は，#3とは違う方法で求めてみました．自分なりのやり方で求めてみてください．

`CSL24{use_factordb}`
                            
